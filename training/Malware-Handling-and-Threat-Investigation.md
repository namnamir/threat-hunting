# Sandbox
A Malware sandbox is a cybersecurity term referring to a specially prepared monitoring environment that mimics an end-user operating environment. Sandboxes represent an important tool in the arsenal of computer security experts and are used in conjunction with dynamic malware analysis techniques to safely observe the behavior of suspected malware in a controlled environment without risking a host machine.

Sandbox environments can be employed in a variety of configurations, depending on the needs of security researchers:
- Full system emulation: A sandbox simulating the physical hardware of the host machine, including memory and CPU.
- Emulation of operating systems: A sandbox emulating the operating system of the end user. It does not emulate the machine hardware.
- Virtualization: A virtual machine (VM)-based sandbox that contains and examines suspicious programs.

Sandboxes prevent applications from gaining access to all system resources and user data, and thus provide proactive malware detection. A sandboxing test executes or detonates code in a safe and isolated environment, where the behavior of the code and output activity can be safely observed.

In the past, sandboxes were not only used for investigation purposes but also for threat detections (honeypoting). However, sandboxing never really did deliver on its promise: to turn the unknown threats into the known ones. Therefore, the detection part is more left to new solutions like endpoint detection and response (EDR) and next-generation antivirus (NGAV). As technologies get evolved, adeversaries get smarter; they do not get easily fooled by honeypots.

[![What is Sandboxing and Why Do You Need It?](https://img.youtube.com/vi/26isu3cm_Oc/0.jpg)](https://www.youtube.com/watch?v=26isu3cm_Oc)


## Difference Between Honeypots and Snadboxes
At a high level, sandboxing involves installing and allowing malware to run for behavioral observation, while honeypots and nets focus on the analysis of threat actors conducting reconnaissance on an infiltrated network, and security deception is the more recent conception of advanced intrusion detection and prevention.

## How to Prepare a Sandbox
There are two general ways to do it; either build our own environment or use 3rd party solutions.

### How to Make Your Own Sandbox
1. Think of dedicated hardware, self-hosted virtual environment (VM), virtual servers (VPS), or cloud services.
2. Install the operationg system (OS) you need for your research.
3. Allocated enough resources (CPU/GPU, RAM, Disk) based on your OS and the purpose of the research.  
4. Setup a different network.  
  4.1. Think of adding your sandbox into DMZ, if your goal is to have internet access.  
  4.2. Isolate the newrok but do not restric it as it should mimic a normal environment.  
5. Install applications an average user (from your research population) uses.
6. Install analysis tools.  
  6.1. Debuggers  
  6.2. Traffic Analyzer  
  6.3. Process Monitoring  
  6.4. Disassemblers  
7. Turn off security tools, e.g., antivirus

[![How To Setup A Sandbox Environment For Malware Analysis](https://img.youtube.com/vi/oPsxy9JF8FM/0.jpg)](https://www.youtube.com/watch?v=oPsxy9JF8FM)

Alternatively, you can use solutions like [Cuckoo](https://cuckoosandbox.org/) that is a modular, automated malware analysis system. Running from command-line on a Linux or Mac host, it uses python and virtualization (VirtualBox, QEMU-KVM, etc) to create an isolated Windows guest environment to safely and automatically run and analyze files to collect comprehensive file behavior analysis.

### 3rd-Party Sandbox Solutions
Nowadays, the majority of 3rd-pary sandboxes are ready-made cloud-based or SaaS solutions. In this case, you do not need to prepare anything; you just bring your any research material (IoC, file, hash, etc.) and run it on the cloud-based or SaaS sandbox platform. Followings are the most famous and gratis services.

You need to use them based on the need you have. For instance, URLscan provides something that Any.Run cannot.
- [Any.Run](https://any.run/)
- [VirusTotal](https://www.virustotal.com/)
- [Joe Sandbox](https://www.joesandbox.com/)
- [Hybrid Analysis](https://Hybrid-Analysis.com)
- [URLscan](https://urlscan.io/)
- [Malwares.com](https://www.malwares.com/)
- [Jotti](https://virusscan.jotti.org/)


# Basic Scripting Techniques
A scripting language or script language is a programming language for a runtime system that automates the execution of tasks that would otherwise be performed individually by a human operator. Scripting languages are usually interpreted at runtime rather than compiled.

Here we focus on Python as a cross-platform scripting language as well as basic Bash (built-in Linux / MacOS shell) and PowerShell (built-in Windows shell).

## Python
After you [install Python](https://wiki.python.org/moin/BeginnersGuide/Download), you barely need to _script_ but you mainly need to run scripts developed by others. To run scripts, use the following commands.
```bash
# if you run Python version 3
python3 SCRIPT_NAME.py

# if you run Python version 2 or Python version 3 is set to default
python3 SCRIPT_NAME.py
```

If you like to learn basic programming skills in Python, just google it to find many free videos and tutorials like [LearnPython](https://www.learnpython.org/) or the following video.

[![Python for Beginners - Learn Python in 1 Hour](https://img.youtube.com/vi/kqtD5dpn9C8/0.jpg)](https://www.youtube.com/watch?v=kqtD5dpn9C8)


# Evasion Techniques
Evasion techniques are what malicious payloads use to avoid detection from EDR, IDS/IPS, Sandboxing services, etc. Malware developers have two priorities when creating malware, being silent and being deadly, getting as much as they can for as little effort as possible. To do so, they use different techniques and tactics; it can be something low-level, high-level, or mixture of different techniques and tactics. In this section, we just focus on **malware evasion techniques**.

Defense evasion is the way to bypass detection, cover what malware is doing, and determine its activity to a specific family or authors. There are different techniques used by threat actors like injection, data encryption, and obfuscating. The tactics often induce payloads and scripts. Some of these techniques are as follows.

- Code Obfuscation and Encryption: Detection solutions can find malware's activities easily. Malware tries to hide malicious codes by obfuscation and encryption.
- Hide Artifacts: Artifacts reveal malicious activity such as files, directories, file attributes, users, etc. Malware tries to hide or isolate them to bypass detection.
- Modify Registry: Change of registry allows the malicious software to conceal data about configuration.
- Virtualization/Sandbox Evasion: Sandboxes are a real challenge for a malicious program. But it knows how to avoid a standard sandbox and recognize the virtual environment from a real one.
- Embeded Codes: Docx or PDF files seem safe but what if an attacker embeds the payload in another file and run it through them?

This video shows how a read team prepare a malware with using multiple evasion techniques and tactics.

[![Windows Defense Evasion Techniques](https://img.youtube.com/vi/5goLhInZyYQ/0.jpg)](https://www.youtube.com/watch?v=5goLhInZyYQ)

# Threat Intelligence Feeds
Threat intelligence feeds are continuous data streams filled with threat information collected by artificial intelligence. These feeds provide information on cybersecurity threats and trends in real-time, enabling organizations to proactively defend against attacks. Security teams can also use this information to better understand potential hackers' tactics, techniques, and procedures and improve their security posture accordingly.

[![Threat Intelligence Feeds](img/Threat-Intelligence-Feeds.png)]

## Types Of Threat Intelligence
Cyber threat intelligence comes in the following three basic categories:

- Strategic: This type of threat intelligence offers high-level analysis for less technical audiences. It may include information about business impacts and how the threat fits into broader trends in the threat landscape. Most strategic threat intelligence comes from open sources, such as local and national media, or white papers and reports.
- Tactical: This type focuses on IoCs to enable immediate threat identification and elimination. Often considered the most basic form of threat intelligence, tactical threat intelligence is more easily generated and often automated.
- Operational: Operational threat intelligence comes from examining the details of past known attacks. By understanding the details of “who?”, “what?”, and “how?”, security teams gain insight into the motives and sophistication of threat actors.

## Why Geopolitical Intels are Important
## Different Feeds and Comparison

# Malicious Email Analysis

# Malicious (Shortened) Link Analysis

# Malicious File Analysis

# Introduction to Hybrid Attacks

# A Grasp to Deeper Analysis

# Documenting and Presenting Findings



--
References:
- [Malware Sandbox]([https://www.spiceworks.com/it-security/cyber-risk-management/articles/what-is-sandboxing/](https://www.vmray.com/glossary/malware-sandbox/))
- [The Difference Between Sandboxing, Honeypots & Security Deception](https://www.darkreading.com/endpoint/the-difference-between-sandboxing-honeypots-security-deception)
- [Is Sandboxing Dead?](https://www.darkreading.com/vulnerabilities-threats/is-sandboxing-dead-)
- [What is an Evasion Technique?](https://www.libraesva.com/what-is-an-evasion-technique/)
- [Malware Evasion Techniques](https://www.cyberdefensemagazine.com/malware-evasion-techniques/)
- [What are Threat Intelligence Feeds?](https://securityscorecard.com/blog/what-are-threat-intelligence-feeds)
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
- []()
